---
title: "CHIKH_ouissem_test"
author: "Ouissem Chikh"
format: html
---

LINK to the github: https://github.com/Ouissem2005/eval-grades.git


#1.1. Study organisation

##q1. 

```{r}
here::i_am("TEST.Rproj")
library(here)
library(vroom)
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
```

```{r}
courses<-vroom(here("subject-3/courses.csv"))
```
alternatively we can use 'read_delim': 

```{r}
fixing_columns <- read_delim(here("subject-3/courses.csv"),
  delim = ","
)
```

we also check the column types: 

```{r}
spec(courses)
```

##q2.

```{r}
courses|>rename(
    "course name" = course,            
    "identifier" = course_id,
    "semester" = semester,
    "number of grades" = nb_grades
  )|>
  arrange(courses)|>
  knitr::kable()
```


##1.2. students 

##q3. 

```{r}
student<-vroom(here("subject-3/students.csv"))

student|>
  mutate(
    birth_date = as.Date(birth_date),
    sex = as.factor(sex)
  )

spec(student)
```
The birth_date column of the students data frame is of classe Date and the sex is identified as a factor.


##q4. 

we can use vroom: 

```{r}
grades<-vroom(here("subject-3/grades.csv"))
```

OR we can use: 

```{r}
grades <- read_delim(here("subject-3", "grades.csv"),
  delim = "|",
  na = "unknown",
)
```

#2. 

##Q5. 

```{r}
group_counts <- student |>
  count(group)

ggplot(group_counts, aes(x = group, y = n, fill='blue')) +
  geom_col() +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  ) +
  theme_minimal()
```

##Q6:

```{r}
student |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") 
```

##Q7. 

```{r}
library(lubridate)
```
```{r}
student|>
   mutate(
    age = time_length(today() - birth_date, unit = "year"),
    age = round(age)  
  )|>
  ggplot(aes(x = age)) +
  geom_histogram(bins = 15,
    fill = "steelblue")
```

##Q8.

```{r}
student|>
   mutate(
    age = time_length(today() - birth_date, unit = "year"),
    age = round(age)  
  )|>
  group_by(group) |>
  summarize(
    Median_Age = round(median(age, na.rm = TRUE)),
    .groups = 'drop'
  )|>knitr::kable()
```

##Q9. 

```{r}
student|>
   mutate(
    age = time_length(today() - birth_date, unit = "year"),
    age = round(age)  
  )|>
  group_by(group)|>
  slice_max(order_by = age, n = 1, with_ties = FALSE)|>
  select(id, sex, age, group)|>
  arrange(desc(age))|>
  ungroup()|>
  knitr::kable()
```


#3. 

##Q10. 

```{r}
total_grades<-grades|>
  mutate(grade_numeric = as.numeric(grade))|>
  summarise(
    total_non_missing = sum(!is.na(grade_numeric))
  ) |>
  pull(total_non_missing) #

num_grades <- total_grades    
```
The data set contains `r num_grades` grades.


##Q11. 

Pour cette question on doit fusinner deux files (students et grades) puis filtrer le cours spÃ©cifique afin de pouvoir calculer et visualiser la moyenne. 

```{r}

course_name <- "Interstellar Travel and Navigation"
course_id_to_filter <- 1 

student<-vroom(here("subject-3/students.csv"))

grades <- read_delim("subject-3/grades.csv", delim = "|", show_col_types = FALSE) %>%
  mutate(
    grade = as.numeric(grade)
  )

courses<-vroom(here("subject-3/courses.csv"))

course_name <- "Interstellar Travel and Navigation"

course_id_to_filter <- courses |>
  filter(course == course_name) |>
  pull(course_id) 

average_grades <- grades|>
  filter(course_id == course_id_to_filter) |>
  left_join(students |> select(id, group), by = "id")|>
  group_by(group) |>
  summarize(
    Average_Grade = mean(grade, na.rm = TRUE),
    .groups = 'drop'
  )

plot_average_grades <- average_grades %>%
  ggplot(aes(x = group, y = Average_Grade)) +
  geom_col(fill = "blue") +
  geom_text(
    aes(label = round(Average_Grade, 1)),
    vjust = -0.5, 
    size = 4
  ) +
  labs(
    title = paste("Note Moyenne en", course_name, "par Groupe"),
    x = "Groupe",
    y = "Note Moyenne"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  theme_minimal()


plot_average_grades
```






