---
title: "CHIKH_ouissem_test"
author: "Ouissem Chikh"
format: html
---

LINK to the github: https://github.com/Ouissem2005/eval-grades.git


#1.1. Study organisation

##q1. 

```{r}
here::i_am("TEST.Rproj")
library(here)
library(vroom)
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
```

```{r}
courses<-vroom(here("subject-3/courses.csv"))
```
alternatively we can use 'read_delim': 

```{r}
fixing_columns <- read_delim(here("subject-3/courses.csv"),
  delim = ","
)
```

we also check the column types: 

```{r}
spec(courses)
```

##q2.

```{r}
courses|>rename(
    "course name" = course,            
    "identifier" = course_id,
    "semester" = semester,
    "number of grades" = nb_grades
  )|>
  arrange(courses)|>
  knitr::kable()
```


##1.2. students 

##q3. 

```{r}
student<-vroom(here("subject-3/students.csv"))

student|>
  mutate(
    birth_date = as.Date(birth_date),
    sex = as.factor(sex)
  )

spec(student)
```
The birth_date column of the students data frame is of classe Date and the sex is identified as a factor.


##q4. 

we can use vroom: 

```{r}
grades<-vroom(here("subject-3/grades.csv"))
```

OR we can use: 

```{r}
grades <- read_delim(here("subject-3", "grades.csv"),
  delim = "|",
  na = "unknown",
)
```

#2. 

##Q5. 

```{r}
group_counts <- student |>
  count(group)

ggplot(group_counts, aes(x = group, y = n, fill='blue')) +
  geom_col() +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  ) +
  theme_minimal()
```

##Q6:

```{r}
student |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") 
```

##Q7. 

```{r}
library(lubridate)
```
```{r}
student|>
   mutate(
    age = time_length(today() - birth_date, unit = "year"),
    age = round(age)  
  )|>
  ggplot(aes(x = age)) +
  geom_histogram(bins = 15,
    fill = "steelblue")
```

##Q8.

```{r}
student|>
   mutate(
    age = time_length(today() - birth_date, unit = "year"),
    age = round(age)  
  )|>
  group_by(group) |>
  summarize(
    Median_Age = round(median(age, na.rm = TRUE)),
    .groups = 'drop'
  )|>knitr::kable()
```

##Q9. 

```{r}
student|>
   mutate(
    age = time_length(today() - birth_date, unit = "year"),
    age = round(age)  
  )|>
  group_by(group)|>
  slice_max(order_by = age, n = 1, with_ties = FALSE)|>
  select(id, sex, age, group)|>
  arrange(desc(age))|>
  ungroup()|>
  knitr::kable()
```


#3. 

##Q10. 

```{r}
total_grades<-grades|>
  mutate(grade_numeric = as.numeric(grade))|>
  summarise(
    total_non_missing = sum(!is.na(grade_numeric))
  ) |>
  pull(total_non_missing) #

num_grades <- total_grades    
```
The data set contains `r num_grades` grades.


##Q11. 

Pour cette question on doit fusinner deux files (students et grades) puis filtrer le cours spécifique afin de pouvoir calculer et visualiser la moyenne. 

```{r}

course_name <- "Interstellar Travel and Navigation"
course_id_to_filter <- 1 

student<-vroom(here("subject-3/students.csv"))

grades <- read_delim("subject-3/grades.csv", delim = "|", show_col_types = FALSE) %>%
  mutate(
    grade = as.numeric(grade)
  )

courses<-vroom(here("subject-3/courses.csv"))

course_name <- "Interstellar Travel and Navigation"

course_id_to_filter <- courses |>
  filter(course == course_name) |>
  pull(course_id) 

average_grades <- grades|>
  filter(course_id == course_id_to_filter) |>
  left_join(student |> select(id, group), by = "id")|>
  group_by(group) |>
  summarize(
    Average_Grade = mean(grade, na.rm = TRUE),
    .groups = 'drop'
  )

plot_average_grades <- average_grades %>%
  ggplot(aes(x = group, y = Average_Grade)) +
  geom_col(fill = "blue") +
  geom_text(
    aes(label = round(Average_Grade, 1)),
    vjust = -0.5, 
    size = 4
  ) +
  labs(
    title = paste("Note Moyenne en", course_name, "par Groupe"),
    x = "Groupe",
    y = "Note Moyenne"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  theme_minimal()


plot_average_grades
```


##Q12. 


```{r}
grades_by_semester <- grades |>
  left_join(courses|> select(course_id, semester), by = "course_id") |>
  mutate(semester = as.factor(semester), grade = as.numeric(grade)) |>
  filter(!is.na(grade), !is.na(semester))

plot_grade_distribution <- grades_by_semester |>
  ggplot(aes(x = grade, fill = semester)) +
  geom_density(alpha = 0.5, size = 1) + 
  labs(
    title = "Comparaison de la Distribution des Notes par Semestre",
    x = "Notes",
    y = "Densité",
    fill = "Semestre"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("1" = "pink", "2" = "orange")) + 
  scale_color_manual(values = c("1" = "pink", "2" = "orange"))

plot_grade_distribution
```
##Q13.

```{r}
grades_by_semester <- grades |>
  left_join(courses|> select(course_id, semester), by = "course_id") |>
  mutate(semester = as.factor(semester), grade = as.numeric(grade)) |>
  filter(!is.na(grade), !is.na(semester))

grades_per_student <- grades|>
  group_by(id) |>
  summarize(
    N_Grades = n(),
    .groups = 'drop'
  )

final_grades_summary <- student |>
  left_join(grades_per_student, by = "id") |>
  mutate(N_Grades = replace_na(N_Grades, 0)) |>
  select(id, sex, group, N_Grades) 

grade_statistics <- final_grades_summary |>
  summarize(
    Minimum = min(N_Grades),
    Maximum = max(N_Grades),
    Moyenne = mean(N_Grades),
    Médiane = median(N_Grades)
  ) |>
  pivot_longer(
    cols = everything(),
    names_to = "Statistique",
    values_to = "Nombre de Notes"
  )
final_grades_summary|>
  slice_tail(n=10)|>
  knitr::kable()
            

```

##Q14. 

```{r}
grades_by_semester <- grades |>
  left_join(courses|> select(course_id, semester), by = "course_id") |>
  mutate(semester = as.factor(semester), grade = as.numeric(grade)) |>
  filter(!is.na(grade), !is.na(semester))

grades_per_student <- grades|>
  group_by(id) |>
  summarize(
    N_Grades = n(),
    .groups = 'drop'
  )

final_grades_summary <- student |>
  left_join(grades_per_student, by = "id") |>
  mutate(N_Grades = replace_na(N_Grades, 0)) |>
  select(id, sex, group, N_Grades) 

plot_grade_count_distribution <- final_grades_summary |>
  mutate(Sex = as.factor(sex))|>
  ggplot(aes(x = Sex, y = N_Grades, fill = Sex)) +
  geom_boxplot() +
  labs(
    title = "Distribution du nombre de notes reçues par étudiant selon le sexe",
    x = "Sexe",
    y = "Nombre Total de Notes Reçues"
  ) +
  theme_minimal()

plot_grade_count_distribution
```

##q15.


```{r}
target_course_name <- "Virtual Reality and Simulated Environments"
target_course_id <- courses |>
  filter(course == target_course_name) |>
  pull(course_id) 

grades_count_vr <- grades|>
  filter(course_id == target_course_id) |>
  group_by(id) |>
  summarize(N_Grades = n(), .groups = 'drop')

students_grades_vr <- student|>
  left_join(grades_count_vr, by = "id") |>
  mutate(N_Grades = replace_na(N_Grades, 0))|>
  select(id, group, -sex, -birth_date, N_Grades)

students_grades_vr|>
  slice_tail(n=10)|>
  knitr::kable()

```


#q16:

```{r}
grades_distribution <- students_grades_vr |>
  group_by(N_Grades) |>
  summarize(N_Students = n(), .groups = 'drop')

grades_distribution |>
  ggplot(aes(x = as.factor(N_Grades), y = N_Students)) +
  geom_col(fill = "blue") +
  geom_text(aes(label = N_Students), vjust = -0.5, size = 4) +
  labs(
    title = "Distribution du Nombre de Notes ",
    x = "Nombre de notes obtenues (par étudiant)",
    y = "Nombre d'étudiants"
  ) +
  theme_minimal() +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15)))


```
##Q17.

```{r}
students_grades_vr |>
  mutate(group = as.factor(group)) |>
  ggplot(aes(x = group, y = N_Grades, fill = group)) +
  geom_boxplot() +
  labs(
    title = "Distribution du nombre de notes par groupe pour le cours Virtual
Reality and Simulated Environments",
    x = "Groupe d'étudiants",
    y = "Nombre total de notes obtenues"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

#q18. 

```{r}
grades |>
  mutate(
    grade = as.numeric(grade)
  ) |>
  filter(!is.na(grade)) 

students_grades_combined <- student|>
  select(id, group, sex) |>
  left_join(grades, by = "id") |>
  mutate(
    group = as.factor(group),
    sex = as.factor(sex)
  )

average_grade_summary <- students_grades_combined |>
  group_by(group, sex) |>
  summarize(
    N_Grades = n(), 
    Average_Grade = mean(grade, na.rm = TRUE),
    .groups = 'drop'
  )

average_grade_summary |>
  mutate(
    `Note Moyenne` = round(Average_Grade, 2)
  ) |>
  rename(
    Groupe = group,
    Sexe = sex,
    `Nbre de Notes` = N_Grades
  ) 

average_grade_summary <- students_grades_combined |>
  group_by(group, sex) |>
  summarize(
    Average_Grade = mean(grade, na.rm = TRUE),
    .groups = 'drop'
  )


average_grade_summary |>
  ggplot(aes(x = group, y = Average_Grade, fill = sex)) +
  geom_boxplot()+
  labs(
    title = "Note Moyenne Générale par Groupe et Sexe",
    x = "Groupe d'Étudiants",
    y = "Note Moyenne",
    fill = "Sexe"
  ) +
  theme_minimal()



```
#q19. 

```{r}
student <- vroom(here("subject-3/students.csv"))|> select(id, group)
courses <- vroom(here("subject-3/courses.csv")) |> select(course_id, course)
grades <- read_delim("subject-3/grades.csv", delim = "|", show_col_types = FALSE) |>
  mutate(grade = as.numeric(grade)) |>
  filter(!is.na(grade)) 

avg_grades_long <- grades|>
  left_join(courses, by = "course_id")|>
  group_by(id, course) |>
  summarize(
    Avg_Grade = mean(grade, na.rm = TRUE),
    .groups = 'drop'
  )

avg_grades_wide <- avg_grades_long |>
  pivot_wider(
    names_from = course,       
    values_from = Avg_Grade    
  )

final_student_summary <- student |>
  left_join(avg_grades_wide, by = "id")

course_col_1 <- "Interstellar Travel and Navigation"
course_col_2 <- "Xenobiology and Extraterrestrial Life"

final_student_summary |>
  head(n = 5) |>
  select(id, group, !!sym(course_col_1), !!sym(course_col_2))|>
  knitr::kable()
```

#q20. 



